var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},initcannon=function(t){function e(e){var i=t.call(this)||this;return i.init(e),i}return __extends(e,t),e.prototype.init=function(t){switch(this.cannonbody=this.createBitmapByName("fish_cannon_1_body_png"),this.cannonbody.anchorOffsetX=this.cannonbody.width/2,this.cannonbody.anchorOffsetY=this.cannonbody.height/2,this.addChild(this.cannonbody),this.cannonhead=this.createBitmapByName("fish_cannon_1_head_png"),this.cannonhead.anchorOffsetX=this.cannonhead.width/2,this.cannonhead.y=-60,this.addChildAt(this.cannonhead,0),t){case 1:this.cannonbody.texture=RES.getRes("fish_cannon_1_body_png"),this.cannonhead.texture=RES.getRes("fish_cannon_1_head_png")}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(initcannon.prototype,"initcannon");var initfish=function(t){function e(e,i,n,h,s){var o=t.call(this)||this;return o.sum=0,o.die=!1,o["catch"]=!1,o.serious="",o.init(e,i,n,h,s),o}return __extends(e,t),e.prototype.init=function(t,e,i,n,h){window[h]=this;var s=this.createBitmapByName(t);s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,this.addChild(s),e[0]<0?s.rotation=180:e[1]>1136&&(s.rotation=0),s.x=e[0],s.y=e[1],this.fish=s,this.kind=t.split("_"),egret.Tween.get(s).to({x:i[0],y:i[1]},n).call(function(){window[h].die=!0}),this.time=new egret.Timer(0,0),this.time.addEventListener(egret.TimerEvent.TIMER,this.animate,this),this.time.start()},e.prototype.animate=function(t){this.sum+=1,this.time.delay=100,null==RES.getRes("fish_"+this.kind[1]+"_1 ("+this.sum.toString()+")_png")&&(this.sum=1),this.fish.texture=RES.getRes("fish_"+this.kind[1]+"_1 ("+this.sum.toString()+")_png")},e.prototype.catched=function(){egret.Tween.removeTweens(this.fish),this.sum=1,this.time.stop(),this.time.removeEventListener(egret.TimerEvent.TIMER,this.animate,this),this.time=new egret.Timer(0,20),this.time.addEventListener(egret.TimerEvent.TIMER,this.catchfish,this),this.time.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.endcatch,this),this.time.start(),this["catch"]=!0},e.prototype.catchfish=function(){this.time.delay=100,this.fish.texture=RES.getRes("fish_"+this.kind[1]+"_catch_"+this.sum.toString()+"_png"),this.sum+=1,null==RES.getRes("fish_"+this.kind[1]+"_catch_"+this.sum.toString()+"_png")&&(this.sum=1)},e.prototype.endcatch=function(){this.time.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.endcatch,this),this.time.removeEventListener(egret.TimerEvent.TIMER,this.catchfish,this),this.fish=null,this.die=!0},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(initfish.prototype,"initfish");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.attackspeed=300,e.ifattack=!1,e.attacktime=100,e.fishsum=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),RES.setMaxLoadingThread(4)},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.createBitmapByName("fish_scene_1_jpg");t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.where,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.cannonrotate,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.cancleshoot,this),this.stage.addChild(t),this.cannon=new initcannon(1),this.stage.addChild(this.cannon),this.cannon.x=188,this.cannon.y=606;var e=Math.random();if(.5>e){this.fishsum+=1;var i=new initfish("fish_1101_1 (1)_png",[-100*Math.random()-50,500*Math.random()+100],[100*Math.random()+1150,500*Math.random()+100],2e4*Math.random()+1e4,"fish"+this.fishsum.toString())}else{this.fishsum+=1;var i=new initfish("fish_1101_1 (1)_png",[100*Math.random()+1150,500*Math.random()+100],[-100*Math.random()-50,500*Math.random()+100],2e4*Math.random()+1e4,"fish"+this.fishsum.toString())}this.stage.addChild(i),this.bulletlist=new Array,this.fishlist=new Array,this.tembullet=new Array,this.fishlist.push(i),this.stage.addEventListener(egret.Event.ENTER_FRAME,this.bulletmove,this);var n=new egret.Timer(1e3,0);n.addEventListener(egret.TimerEvent.TIMER,this.creatfish,this),n.start()},e.prototype.creatfish=function(){var t=Math.random();if(.5>t){this.fishsum+=1;var e=new initfish("fish_1103_1 (1)_png",[-100*Math.random()-50,500*Math.random()+100],[100*Math.random()+1150,500*Math.random()+100],2e4*Math.random()+1e4,"fish"+this.fishsum.toString())}else{this.fishsum+=1;var e=new initfish("fish_1101_1 (1)_png",[100*Math.random()+1150,500*Math.random()+100],[-100*Math.random()-50,500*Math.random()+100],2e4*Math.random()+1e4,"fish"+this.fishsum.toString())}this.stage.addChild(e),this.fishlist.push(e)},e.prototype.where=function(t){console.log(t.stageX+":"+t.stageY),t.stageX>this.cannon.x&&(this.cannon.rotation=Math.atan((t.stageY-this.cannon.y)/(t.stageX-this.cannon.x))*(180/Math.PI)+90),t.stageX<this.cannon.x&&(this.cannon.rotation=Math.atan((t.stageY-this.cannon.y)/(t.stageX-this.cannon.x))*(180/Math.PI)-90),this.ifattack=!0},e.prototype.cannonrotate=function(t){t.stageX>this.cannon.x&&(this.cannon.rotation=Math.atan((t.stageY-this.cannon.y)/(t.stageX-this.cannon.x))*(180/Math.PI)+90),t.stageX<this.cannon.x&&(this.cannon.rotation=Math.atan((t.stageY-this.cannon.y)/(t.stageX-this.cannon.x))*(180/Math.PI)-90)},e.prototype.shoot=function(){if(this.attacktime>=this.attackspeed){var t=this.createBitmapByName("fish_bullet_1_png");t.kind="fish_bullet_1_png",this.stage.addChildAt(t,2),this.bulletlist.push(t),t.rotation=this.cannon.rotation,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=this.cannon.x,t.y=this.cannon.y,t.d=50,this.attacktime=0}this.attacktime+=30},e.prototype.bulletmove=function(){this.deletebullet(),this.iffishdie(),this.checkhit();for(var t=0;t<this.bulletlist.length;t++)this.bulletlist[t].y=this.cannon.y-this.bulletlist[t].d*Math.sin(Math.PI/180*(90-this.bulletlist[t].rotation)),this.bulletlist[t].x=this.bulletlist[t].d*Math.cos(Math.PI/180*(90-this.bulletlist[t].rotation))+this.cannon.x,this.bulletlist[t].d+=8,(this.bulletlist[t].x>1190||this.bulletlist[t].x<-60||this.bulletlist[t].y>700||this.bulletlist[t].y<-60)&&this.tembullet.push(this.bulletlist[t]);this.ifattack&&this.shoot()},e.prototype.cancleshoot=function(){this.ifattack=!1},e.prototype.iffishdie=function(){for(var t=new Array,e=0;e<this.fishlist.length;e++)this.fishlist[e].die&&(t.push(this.fishlist[e]),this.stage.removeChild(this.fishlist[e]));for(var e=0;e<t.length;e++)this.fishlist.splice(this.fishlist.indexOf(t[e]),1)},e.prototype.checkhit=function(){for(var t=0;t<this.fishlist.length;t++)for(var e=0;e<this.bulletlist.length;e++)this.sat(this.bulletlist[e],this.fishlist[t].getChildAt(0))&&(this.fishlist[t]["catch"]||(this.fishlist[t].catched(),this.tembullet.push(this.bulletlist[e]),this.creatnet(this.bulletlist[e].kind,[this.bulletlist[e].x,this.bulletlist[e].y])))},e.prototype.deletebullet=function(){for(var t=0;t<this.tembullet.length;t++)this.bulletlist.splice(this.bulletlist.indexOf(this.tembullet[t]),1),this.stage.removeChild(this.tembullet[t]);this.tembullet=[]},e.prototype.creatnet=function(t,e){var i=t.split("_"),n=this.createBitmapByName("fish_net_"+i[2].toString()+"_png");this.stage.addChild(n),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=e[0],n.y=e[1],n.scaleX=n.scaleY=.2,egret.Tween.get(n).to({scaleX:1,scaleY:1},300),egret.setTimeout(function(){try{this.stage.removeChild(n)}catch(t){throw new Error(t)}},this,600)},e.prototype.sat=function(t,e){var i=new egret.Point(t.x,t.y),n=new egret.Point(e.x,e.y),h=-t.width/2,s=-t.height/2,o=t.width/2,a=t.height/2,r=-e.width/2,c=-e.height/2,l=e.width/2,d=e.height/2,u=[h,s,o,a],f=[r,c,l,d];if(SAT.boundHit(i,n,u,f)){var g=new egret.Point((0-t.width/2.4-0)*Math.cos(Math.PI/180*t.rotation)-(0-t.height/2.4)*Math.sin(Math.PI/180*t.rotation),(0-t.width/2.4-0)*Math.sin(Math.PI/180*t.rotation)+(0-t.height/2.4)*Math.cos(Math.PI/180*t.rotation)),p=new egret.Point((0+t.width/2.4-0)*Math.cos(Math.PI/180*t.rotation)-(0-t.height/2.4)*Math.sin(Math.PI/180*t.rotation),(0+t.width/2.4-0)*Math.sin(Math.PI/180*t.rotation)+(0-t.height/2.4)*Math.cos(Math.PI/180*t.rotation)),y=new egret.Point((0+t.width/2.4-0)*Math.cos(Math.PI/180*t.rotation)-(0+t.height/2.4)*Math.sin(Math.PI/180*t.rotation),(0+t.width/2.4-0)*Math.sin(Math.PI/180*t.rotation)+(0+t.height/2.4)*Math.cos(Math.PI/180*t.rotation)),m=new egret.Point((0-t.width/2.4-0)*Math.cos(Math.PI/180*t.rotation)-(0+t.height/2.4)*Math.sin(Math.PI/180*t.rotation),(0-t.width/2.4-0)*Math.sin(Math.PI/180*t.rotation)+(0+t.height/2.4)*Math.cos(Math.PI/180*t.rotation)),M=new egret.Point((0-e.width/2.4-0)*Math.cos(Math.PI/180*e.rotation)-(0-e.height/2.4)*Math.sin(Math.PI/180*e.rotation),(0-e.width/2.4-0)*Math.sin(Math.PI/180*e.rotation)+(0-e.height/2.4)*Math.cos(Math.PI/180*e.rotation)),E=new egret.Point((0+e.width/2.4-0)*Math.cos(Math.PI/180*e.rotation)-(0-e.height/2.4)*Math.sin(Math.PI/180*e.rotation),(0+e.width/2.4-0)*Math.sin(Math.PI/180*e.rotation)+(0-e.height/2.4)*Math.cos(Math.PI/180*e.rotation)),_=new egret.Point((0+e.width/2.4-0)*Math.cos(Math.PI/180*e.rotation)-(0+e.height/2.4)*Math.sin(Math.PI/180*e.rotation),(0+e.width/2.4-0)*Math.sin(Math.PI/180*e.rotation)+(0+e.height/2.4)*Math.cos(Math.PI/180*e.rotation)),v=new egret.Point((0-e.width/2.4-0)*Math.cos(Math.PI/180*e.rotation)-(0+e.height/2.4)*Math.sin(Math.PI/180*e.rotation),(0-e.width/2.4-0)*Math.sin(Math.PI/180*e.rotation)+(0+e.height/2.4)*Math.cos(Math.PI/180*e.rotation));return SAT.sat(i,n,[g,p,y,m],[M,E,_,v],!1,!1)}return!1},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var SAT;!function(t){function e(t,e,n,h,s,o){if(void 0===s&&(s=!1),void 0===o&&(o=!1),n.length<1||h.length<1)return!1;var a="Array"==n[0].constructor.name,r="Array"==h[0].constructor.name;if(!a&&!r)return i(t,e,n,h,s,o);var c=0,l=0;if(a&&r){for(c=0;c<n.length;c++)for(l=0;l<n.length;l++)if(i(t,e,n[c],h[l],s,o))return!0;return!1}if(a){for(c=0;c<n.length;c++)if(i(t,e,n[c],h,s,o))return!0;return!1}for(c=0;c<h.length;c++)if(i(t,e,n,h[c],s,o))return!0;return!1}function i(t,e,i,h,s,o){if(void 0===s&&(s=!1),void 0===o&&(o=!1),i.length<1||h.length<1)return!1;if(s&&o)return n(t,e,i,h);var a=[];if(s&&o){var g=new egret.Point(t.x-e.x,t.y-e.y);a.push(c(r(g)))}else s||(a=l(i,a)),o||(a=l(h,a));var p,y,m=new egret.Point;for(p=0;p<a.length;p++)if(y=s?f(t,i,a[p]):u(t,i,a[p]),m=o?f(e,h,a[p]):u(e,h,a[p]),!d(y,m))return!1;return!0}function n(t,e,i,n){if(2!=i.length||2!=n.length)return!1;var h=Math.pow(i[0].x+t.x-(n[0].x+e.x),2)+Math.pow(i[0].y+t.y-(n[0].y+e.y),2),s=Math.pow(i[1].x+n[1].x,2);return s>h}function h(t){if(t.length<1)return[0,0,0,0];for(var e=[t[0].x,t[0].y,t[0].x,t[0].y],i=0;i<t.length;i++)t[i].x<e[0]&&(e[0]=t[i].x),t[i].y<e[1]&&(e[1]=t[i].y),t[i].x>e[2]&&(e[2]=t[i].x),t[i].y>e[3]&&(e[3]=t[i].y);return e}function s(t){if(2!=t.length)return[0,0,0,0];var e=[t[0].x-t[1].x,t[0].y-t[1].x,t[0].x+t[1].x,t[0].y+t[1].x];return e}function o(t,e,i,n){return 4!=i.length||4!=n.length?!1:d(new egret.Point(i[0]+t.x,i[2]+t.x),new egret.Point(n[0]+e.x,n[2]+e.x))&&d(new egret.Point(i[1]+t.y,i[3]+t.y),new egret.Point(n[1]+e.y,n[3]+e.y))?!0:!1}function a(t,e){return t.x*e.x+t.y*e.y}function r(t){var e=new egret.Point(t.x,t.y),i=Math.sqrt(e.x*e.x+e.y*e.y);return i?(e.x=Math.round(100*e.x/i)/100,e.y=Math.round(100*e.y/i)/100,e):e}function c(t){var e=new egret.Point(t.x,t.y),i=e.x;return e.x=e.y,e.y=-i,e}function l(t,e){void 0===e&&(e=[]);var i,n=0,h=!1,s=new egret.Point,o=new egret.Point;for(i=0;i<t.length;i++){for(i>=t.length-1?(o.x=t[0].x-t[i].x,o.y=t[0].y-t[i].y):(o.x=t[i+1].x-t[i].x,o.y=t[i+1].y-t[i].y),s=c(r(o)),s.x<=0&&(0==s.x?s.y<0&&(s.y*=-1):(s.x*=-1,s.y*=-1)),h=!0,n=0;n<e.length;n++)if(e[n].x==s.x&&e[n].y==s.y){h=!1;break}h&&e.push(s)}return e}function d(t,e){return t.x>e.y?0:t.y<e.x?0:((t.x-e.x)*(e.x-e.y)<0,1)}function u(t,e,i){var n,h,s=new egret.Point,o=0;h=a(new egret.Point(e[0].x+t.x,e[0].y+t.y),i),o=h;for(var r=1;r<e.length;r++)n=a(new egret.Point(e[r].x+t.x,e[r].y+t.y),i),h>n&&(h=n),n>o&&(o=n);return s.x=h,s.y=o,s}function f(t,e,i){var n=new egret.Point;return n.x=a(new egret.Point(e[0].x+t.x,e[0].y+t.y),i)-e[1].x,n.y=n.x+2*e[1].x,n}t.sat=e,t.circleHit=n,t.getPolyBound=h,t.getCircleBound=s,t.boundHit=o,t.dot=a,t.normalize=r,t.perp=c}(SAT||(SAT={}));